package entities;

import java.awt.Color;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Rectangle;
import java.awt.event.MouseEvent;

import entities.projectiles.Projectile;
import general.Camera;
import general.Game;
import general.Level;
import input.KeyInput;
import util.Utils;
import util.Velocity;

public class Player extends InputGameObject {
	
	private double _acc = 1.0;
	private double _dcc = 0.5;
	private KeyInput input;

	public Player(Level level, double x, double y, double width, double height, ID id) {
		super(level, x, y, width, height, id);
		this.health = 10;
	}

	@Override
	public void tick(Level level) {
		move();
		
		simulateMapCollsions(true);
		addVelocity();
	}
	
	@Override
	public void render(Graphics g) {
		g.setColor(Color.white);
		g.fillRect((int)x, (int)y, (int)width, (int)height);
		
		Graphics2D g2d = (Graphics2D) g.create();
		Rectangle rect2 = new Rectangle((int) (x+(width/2)), (int) (y+(height/3)), 60, 20);
	    g2d.rotate(Math.toRadians(0), (int) (x+(width/2)-16), (int) (y+(height/2)-16));
		g2d.setColor(Color.orange);
		g2d.draw(rect2);
		g2d.fill(rect2);
		g2d.dispose();
	}
	public void setController(KeyInput input) {
		this.input = input;
	}
	private void move() {
		if (input.keys[0]) velocity.setX(velocity.getX()+_acc);
		else if (input.keys[1]) velocity.setX(velocity.getX()-_acc);
		else if (!(input.keys[0]) && !input.keys[1]) {
			if (velocity.getX() > 0) velocity.setX(velocity.getX()-_dcc);
			else if (velocity.getX() < 0) velocity.setX(velocity.getX()+_dcc);
		}
		
		if (input.keys[3]) velocity.setY(velocity.getY()+_acc);
		else if (input.keys[2]) velocity.setY(velocity.getY()-_acc);
		else if (!(input.keys[2]) && !input.keys[3]) {
			if (velocity.getY() > 0) velocity.setY(velocity.getY()-_dcc);
			else if (velocity.getY() < 0) velocity.setY(velocity.getY()+_dcc);
		}
		
		velocity.setX(Utils.clamp(velocity.getX(), -5, 5));
		velocity.setY(Utils.clamp(velocity.getY(), -5, 5));
	}
	public void mousePressed(MouseEvent e) {
		int mx = e.getX();
		int my = e.getY();
		
		GameObject tempBullet = new Projectile(level, x+32, y+32, 8, 8, ID.BULLET, this);
		Game.handler.addObject(tempBullet);
//		float angle = (float) Math.atan2(my - y+Camera.getY(), mx - x+Camera.getX());
//		int bulletVel = 10;
//		tempBullet.setVelocity(new Velocity((float) (Math.cos(angle)), (float) (Math.sin(angle))).normalize().multiply(bulletVel));
		float angle = (float) Math.atan2(my - y+Camera.getY(), mx - x+Camera.getX());
		int bulletVel = 10;
		tempBullet.setVelocity(new Velocity(Math.cos(mx - x+Camera.getX()), Math.sin(my - y+Camera.getY())).multiply(bulletVel));
	}
}
